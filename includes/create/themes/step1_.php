<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Tạo website</title>
<link rel="stylesheet" type="text/css" href="http://nhaxe.vn/themes/web/resources/plugins/bootstrapv3/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="http://nhaxe.vn/themes/web/resources/css/style.css?v=1112">
<link rel="stylesheet" type="text/css" href="http://nhaxe.vn/themes/web/resources/plugins/font-awesome-4.2.0/css/font-awesome.min.css">
<script src="http://nhaxe.vn/themes/web/resources/js/jquery-1.11.1.min.js"></script>
<script src="http://nhaxe.vn/themes/web/resources/plugins/bootstrapv3/js/bootstrap.min.js"></script>
</head>

<body class="wbody">
<div class="web-body">
  

  <div class="container">
    <div class="col-md-11">
      <div class="main-web">
        
        <div class="col-md-5">
          <div class="panel panel-default ">
            <div class="panel-body pd-20">
              <form class="form-horizontal">
                <fieldset>
                  <legend style="
    text-align: center;
">
                  <h4>TẠO WEB NHÀ XE!</h4>
                  </legend>
                  <div class="form-group">
                    <div class="col-lg-12">
                      <div class="input-group">

                        
                        <input id="website" name="website" class="form-control" placeholder="Tên rút gọn" type="text" data-container="body" data-toggle="popover" data-placement="left" data-content="Tên rút gọn viết liền và không có dấu. ( ví dụ: hoanglong )." data-original-title="" title="" data-trigger="focus" >
<span class="input-group-addon" ><strong>.nhaxe.vn</strong></span>
                      </div>
                      <p class="showerror_tenrg text-danger" style="display:none"><i class="fa fa-exclamation-circle"></i> Tên rút gọn đã tồn tại, vui lòng chọn tên khác !</p>
                      <p class="showsucess_tenrg text-success" style="display:none"><i class="fa fa-check-circle"></i> Bạn có thể sử dụng tên này !</p>

                    </div>
                  </div>
                  <div class="form-group">
                    <div class="col-lg-12">
                      <input type="text" class="form-control" id="inputEmail" placeholder="Email" data-container="body" data-toggle="popover" data-placement="left" data-content="Nhập email của bạn, chú ý một email tương đương 1 website trên hệ thống." data-original-title="" title="" data-trigger="focus" >
                    </div>
                  </div>
                      <p class="showerror_email text-danger" style="display:none"><i class="fa fa-exclamation-circle"></i> Email đã tồn tại, vui lòng chọn tên khác !</p>
                      <p class="showsucess_email text-success" style="display:none"><i class="fa fa-check-circle"></i> Bạn có thể sử dụng tên này !</p>

                   <div class="form-group">
                    <div class="col-lg-12">
                      <input type="text" class="form-control" id="inputPhone" placeholder="Số điện thoại" data-container="body" data-toggle="popover" data-placement="left" data-content="Số điện thoại di động hoặc số cố định của bạn." data-original-title="" title="" data-trigger="focus" >
                    </div>
                  </div>
                      <p class="showerror_phone text-danger" style="display:none"><i class="fa fa-exclamation-circle"></i> Không được để trống số điện thoại !</p>
                      <p class="showsucess_phone text-success" style="display:none"><i class="fa fa-check-circle"></i> Bạn có thể sử dụng tên này !</p>

                  <div class="form-group">
                    <div class="col-lg-12">
                      <input type="text" class="form-control" id="inputAddress" placeholder="Địa chỉ" data-container="body" data-toggle="popover" data-placement="left" data-content="Địa chỉ công ty hoặc nơi ở của bạn." data-original-title="" title="" data-trigger="focus" >
                    </div>
                  </div>
                      <p class="showerror_address text-danger" style="display:none"><i class="fa fa-exclamation-circle"></i> Không được để trống địa chỉ !</p>
                      <p class="showsucess_address text-success" style="display:none"><i class="fa fa-check-circle"></i> Bạn có thể sử dụng tên này !</p>


                  <div class="form-group">
                    <div class="col-lg-12">
                      <input type="password" class="form-control" id="inputPassword" placeholder="Mật khẩu" data-container="body" data-toggle="popover" data-placement="left" data-content="Mật khẩu >6 ký tự." data-original-title="" title="" data-trigger="focus" >
                    </div>
                  </div>
                    <p class="showerror_passwd text-danger" style="display:none"><i class="fa fa-exclamation-circle"></i> Tên rút gọn đã tồn tại, vui lòng chọn tên khác !</p>
                    <p class="showsucess_passwdtext-success" style="display:none"><i class="fa fa-check-circle"></i> Bạn có thể sử dụng tên này !</p>



                  

                  <br/>

                  <div class="form-group">
                    <div class="col-lg-12 text-center ">
                      <a   class="btn btn-primary btn-lg createweb"><i style="display:none;" class="fa fa-cog fa-spin"></i> Tạo web nhà xe</a>
                    </div>
                  </div>
                  <div class="bs-component">

            </div>
                </fieldset>
              </form>

              <!-- Modal -->
                <div class="modal fade" id="showAlert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">

                      <div class="modal-body">
                        <h4>Website đã tạo thành công !</h4>
                        <p>( hệ thống chuyển hướng sang chọn giao diện )...</p>
                      </div>

                    </div>
                  </div>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
 <style>
 .modal-dialog {
width: 400px;
margin: 10% auto;
text-align:center;
}
 </style>
<script> 
function IsEmail(email) {
  var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
  return regex.test(email);
}
function IsTenrg(tenrg) {
  var regex = /^([a-z0-9])+$/;
  return regex.test(tenrg);
}
function reset_noti(){
  $('.showerror_tenrg').fadeOut();
  $('.showerror_email').fadeOut();
  $('.showerror_passwd').fadeOut();
  $('.showsucess_tenrg').fadeOut();
  $('.showsucess_email').fadeOut();
  $('.showsucess_passwd').fadeOut();
  $('.showerror_phone').fadeOut();
  $('.showerror_address').fadeOut();
}
function show_mes(value,mess,type){
  var nameclass_error = '.showerror_'+value;
  var nameclass_sucess = '.showsucess_'+value;

  if(type == 1){
    $(nameclass_error).html('<i class="fa fa-exclamation-circle"></i>'+mess);

    $(nameclass_error).fadeIn();
    $(nameclass_sucess).fadeOut();
  }
  else
  {
    $(nameclass_sucess).html('<i class="fa fa-check-circle">'+mess);

    $(nameclass_sucess).fadeIn();
    $(nameclass_error).fadeOut();
  }

}

   $(function () {
    $('[data-toggle="popover"]').popover();


    // $('.wbody').mousemove(function(e){
    //   var amountMovedX = (e.pageX * -1 / 50);
    //   var amountMovedY =94+ (e.pageY * -1 / 50);
    //   $(this).css('background-position', amountMovedX + 'px ' + amountMovedY + 'px');

    // });

    $('body').on('change', '#kdcare', function(event) {
      event.preventDefault();
      var check=$(this).prop('checked');
      if(check==true){
        $('#formKdcare').slideDown();
      }else{
        $('#formKdcare').slideUp();
        $('.showerror_kdcare').hide();
      }
    });

  });
  $('#website').keypress(function(){
    $('.showerror_tenrg').fadeOut();
    $('.showsucess_tenrg').fadeOut();
  });
  $('#website').change(function(){
      var tenrg = $('#website').val();
      $('.showerror_tenrg').fadeOut();
      $('.showsucess_tenrg').fadeOut();
      if ( tenrg.trim() == '') {
          show_mes('tenrg','Tên rút gọn không thể để trống!',1);
          $('#website').focus();
          return false;
      }
      if ( !IsTenrg(tenrg.trim()) ) {
          show_mes('tenrg','Tên rút gọn không đúng định dạng, tên rút gọn chỉ chấp nhận chữ cái tiếng Anh viết thường và chữ số!',1);
          $('#website').focus();
          return false;
      }
      //console.log(tenrg);
      $.ajax({
            url: '<?=$_B['create_home']?>?mod=ajax',
            type: 'POST',
            data: {action:'checktenrg',tenrg: tenrg},
            success: function(data){
              console.log(data);
              if(data.status){
                show_mes('tenrg','Bạn có thể sử dụng tên này !',0);
              }
              else
              {
                  show_mes('tenrg','Tên rút gọn đã được dùng, hãy chọn tên khác!',1);
                  $('#website').focus();
                  return false;
              }
            }
      });
  });
   $('#inputEmail').keypress(function(){
    $('.showerror_email').fadeOut();
    $('.showsucess_email').fadeOut();
  });
  $('#inputEmail').change(function(){
    $('.showerror_email').fadeOut();
    $('.showsucess_email').fadeOut();
        var email = $('#inputEmail').val();

        if ( email.trim() == '') {
          show_mes('email','Email không thể để trống!',1);
          $('#inputEmail').focus();
          return false;
        }
        if ( !IsEmail(email.trim()) ) {
          show_mes('email','Email không đúng định dạng!',1);
          $('#inputEmail').focus();
          return false;
        }
         $.ajax({
            url: '<?=$_B['create_home']?>?mod=ajax',
            type: 'POST',
            dataType: 'JSON',
            data: {action:'checkemail',email: email},
            success: function(data){
              console.log(data);
              if(data.status){
                show_mes('email','Bạn có thể sử dụng email này !',0);
              }
              else
              {
                  show_mes('email','Email đã được sử dụng, hãy chọn tên khác!',1);
                  $('#inputEmail').focus();
                  return false;
              }
            }
      });
  });


  $(".createweb").on('click',function(){
        reset_noti();
        var tenrg = $('#website').val();
        var email = $('#inputEmail').val();
        var passwd = $('#inputPassword').val();
        var phone = $('#inputPhone').val();
        var address = $('#inputAddress').val();
        var checkkdcare=$('#kdcare').prop('checked');

        if ( tenrg.trim() == '') {
          show_mes('tenrg','Tên rút gọn không được để trống!',1);
          $('#website').focus();
          return false;
        }

        if ( email.trim() == '') {
          show_mes('email','Email không được để trống!',1);
          $('#inputEmail').focus();
          return false;
        }
        if ( !IsEmail(email.trim()) ) {
          show_mes('email','Email không đúng định dạng!',1);
          $('#inputEmail').focus();
          return false;
        }

        if(isNaN(parseInt(phone)) || phone.length>11 || phone.length<10){
          show_mes('phone','Vui lòng điền chính xác số điện thoại!',1);
          $('#inputPhone').focus();
          return false;
        }

        if(address.length<11){
          show_mes('address','Vui lòng điền chính xác địa chỉ!',1);
          $('#inputAddress').focus();
          return false;
        }

        if ( passwd.trim() == '') {
          show_mes('passwd','Mật khẩu không được để trống!',1);
          $('#inputPassword').focus();
          return false;
        }
        if ( passwd.trim() == '123456') {
          show_mes('passwd','Mật khẩu 123456 quá đơn giản, hảy chọn mật khẩu khác!',1);
          $('#inputPassword').focus();
          return false;
        }
        if ( passwd.trim() == tenrg.trim()) {
          show_mes('passwd','Mật khẩu không được trùng với tên rút gọn, hãy chọn mật khẩu khác!',1);
          $('#inputPassword').focus();
          return false;
        }
        if ( passwd.trim().length < 6) {
          show_mes('passwd','Mật khẩu quá ngắn, hãy chọn mật khẩu lớn hơn 6 ký tự!',1);
          $('#inputPassword').focus();
          return false;
        }
        var kdcare='';
        <?php
if (!empty($_GET['temp'])) {
	$temp = (int) $_GET['temp'];
	echo "var idtemp = $temp;";
} else {
	echo "var idtemp = 0;";
}
?>
        if(checkkdcare==true){
          kdcare=$('#inputKdcare').val();
          var length_kdcare=kdcare.split('-');
          if($.trim(kdcare)==false){
            show_mes('kdcare','Vui lòng điền chính xác thông tin như mẫu yêu cầu.!',1);
            $('#inputKdcare').focus();
            return false;
          }else if(length_kdcare.length<4){
            show_mes('kdcare','Vui lòng điền chính xác thông tin như mẫu yêu cầu.!',1);
            $('#inputKdcare').focus();
            return false;
          }
        }

        $(this).find("i").css("display","inline-block");
        reset_noti();
        $.ajax({
            url: '<?=$_B['create_home']?>?mod=ajax',
            type: 'POST',
            data: {action:'createweb',tenrg: tenrg, email: email, passwd: passwd, phone: phone, address: address,kdcare:kdcare,idtemp:idtemp},
            success: function(data){
              console.log(data);
              if(data.status){
                  window.setTimeout(function(){
                    $('#showAlert').modal('show');
                    window.setTimeout(function() {
                      window.location.href = '<?=$_B['create_home']?>?step=2';
                    }, 1500);
                  }, 500);
              }
              else
              {
                  show_mes(data.type,data.message,1);
              }
            }
        });
    // window.setTimeout(function(){
    //   $('#showAlert').modal('show');
    //   window.setTimeout(function() {
    //     window.location.href = '<?=$_B['create_home']?>?step=2';
    //   }, 2000);
    // }, 1000);
  });



</script>
</body>
</html>
